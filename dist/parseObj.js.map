{
  "version": 3,
  "sources": ["../buildScripts/parseObj.ts"],
  "sourcesContent": ["import fs from \"fs\"\r\nimport readline from \"readline\"\r\nimport {opendir} from \"fs/promises\";\r\n\r\n\r\n\r\n// Load OBJ Data from file path\r\n\r\nexport async function loadObj(filePath: string) {\r\n\r\n    const modelnamesplit = filePath.split(\"/\").pop()?.split(\".\") ; // Get the file name without extension\r\n     // modelnamesplit should be something like stanfordbunny for file path ./assets/models/stanfordbunny.obj\r\n    if(!modelnamesplit || modelnamesplit.length === 0) {\r\n        throw new Error(`Invalid file path: ${filePath}`);\r\n    }\r\n    const modelname = modelnamesplit[0] ;\r\n\r\n    const input = fs.createReadStream(filePath);\r\n    const rl = readline.createInterface({\r\n        input,\r\n        crlfDelay: Infinity\r\n    });\r\n\r\n    const positions: number[] = [];\r\n    const indices: number[] = [];\r\n\r\n    for await (const line of rl) {\r\n        if (!line || line[0] === \"#\") continue;\r\n\r\n        if (line.startsWith(\"v \")) {\r\n            const [, x, y, z] = line.trim().split(/\\s+/);\r\n            positions.push(+x, +y, +z);\r\n        }\r\n\r\n        if (line.startsWith(\"f \")) {\r\n            const [, a, b, c] = line.trim().split(/\\s+/);\r\n            indices.push(+a - 1, +b - 1, +c - 1);\r\n        }\r\n    }\r\n\r\n    const vertices = new Float32Array(positions);\r\n    const normals = new Float32Array(vertices.length); // initialized to 0\r\n    for (let i = 0; i < indices.length; i += 3) {\r\n        const i0 = indices[i] * 3;\r\n        const i1 = indices[i + 1] * 3;\r\n        const i2 = indices[i + 2] * 3;\r\n\r\n        const p0x = vertices[i0];\r\n        const p0y = vertices[i0 + 1];\r\n        const p0z = vertices[i0 + 2];\r\n\r\n        const p1x = vertices[i1];\r\n        const p1y = vertices[i1 + 1];\r\n        const p1z = vertices[i1 + 2];\r\n\r\n        const p2x = vertices[i2];\r\n        const p2y = vertices[i2 + 1];\r\n        const p2z = vertices[i2 + 2];\r\n\r\n        // edges\r\n        const e1x = p1x - p0x;\r\n        const e1y = p1y - p0y;\r\n        const e1z = p1z - p0z;\r\n\r\n        const e2x = p2x - p0x;\r\n        const e2y = p2y - p0y;\r\n        const e2z = p2z - p0z;\r\n\r\n        // cross(e1, e2)\r\n        const nx = e1y * e2z - e1z * e2y;\r\n        const ny = e1z * e2x - e1x * e2z;\r\n        const nz = e1x * e2y - e1y * e2x;\r\n\r\n        // accumulate\r\n        normals[i0]     += nx;\r\n        normals[i0 + 1] += ny;\r\n        normals[i0 + 2] += nz;\r\n\r\n        normals[i1]     += nx;\r\n        normals[i1 + 1] += ny;\r\n        normals[i1 + 2] += nz;\r\n\r\n        normals[i2]     += nx;\r\n        normals[i2 + 1] += ny;\r\n        normals[i2 + 2] += nz;\r\n    }\r\n\r\n    for (let i = 0; i < normals.length; i += 3) {\r\n        const x = normals[i];\r\n        const y = normals[i + 1];\r\n        const z = normals[i + 2];\r\n\r\n        const len = Math.hypot(x, y, z);\r\n        if (len > 1e-6) {\r\n            normals[i]     = x / len;\r\n            normals[i + 1] = y / len;\r\n            normals[i + 2] = z / len;\r\n        }\r\n    }\r\n\r\n\r\n    fs.writeFileSync(\r\n        \"./public/assets/models/\" + modelname + \".json\",\r\n        JSON.stringify({\r\n            // flatten vertices to array of numbers\r\n            vertices: Array.from(vertices),\r\n            normals:  Array.from(normals),\r\n            indices: indices\r\n        }),\r\n        \"utf8\"\r\n\r\n    )\r\n}\r\n\r\nconst modelDir = \"./public/assets/models\";\r\n\r\nconst modelNames: string[] = [];\r\n\r\nconst dir = await opendir(modelDir);\r\nfor await (const d of dir) {\r\n    if (d.isFile()) {\r\n        modelNames.push(d.name);\r\n    }\r\n}\r\n\r\nfor (const modelName of modelNames) {\r\n    if (modelName.endsWith(\".obj\")) {\r\n        console.log(`Processing ${modelName}...`);\r\n        await loadObj(`${modelDir}/${modelName}`);\r\n    }\r\n}\r\n\r\n"],
  "mappings": ";AAAA,OAAO,QAAQ;AACf,OAAO,cAAc;AACrB,SAAQ,eAAc;AAMtB,eAAsB,QAAQ,UAAkB;AAE5C,QAAM,iBAAiB,SAAS,MAAM,GAAG,EAAE,IAAI,GAAG,MAAM,GAAG;AAE3D,MAAG,CAAC,kBAAkB,eAAe,WAAW,GAAG;AAC/C,UAAM,IAAI,MAAM,sBAAsB,QAAQ,EAAE;AAAA,EACpD;AACA,QAAM,YAAY,eAAe,CAAC;AAElC,QAAM,QAAQ,GAAG,iBAAiB,QAAQ;AAC1C,QAAM,KAAK,SAAS,gBAAgB;AAAA,IAChC;AAAA,IACA,WAAW;AAAA,EACf,CAAC;AAED,QAAM,YAAsB,CAAC;AAC7B,QAAM,UAAoB,CAAC;AAE3B,mBAAiB,QAAQ,IAAI;AACzB,QAAI,CAAC,QAAQ,KAAK,CAAC,MAAM,IAAK;AAE9B,QAAI,KAAK,WAAW,IAAI,GAAG;AACvB,YAAM,CAAC,EAAE,GAAG,GAAG,CAAC,IAAI,KAAK,KAAK,EAAE,MAAM,KAAK;AAC3C,gBAAU,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAAA,IAC7B;AAEA,QAAI,KAAK,WAAW,IAAI,GAAG;AACvB,YAAM,CAAC,EAAE,GAAG,GAAG,CAAC,IAAI,KAAK,KAAK,EAAE,MAAM,KAAK;AAC3C,cAAQ,KAAK,CAAC,IAAI,GAAG,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC;AAAA,IACvC;AAAA,EACJ;AAEA,QAAM,WAAW,IAAI,aAAa,SAAS;AAC3C,QAAM,UAAU,IAAI,aAAa,SAAS,MAAM;AAChD,WAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK,GAAG;AACxC,UAAM,KAAK,QAAQ,CAAC,IAAI;AACxB,UAAM,KAAK,QAAQ,IAAI,CAAC,IAAI;AAC5B,UAAM,KAAK,QAAQ,IAAI,CAAC,IAAI;AAE5B,UAAM,MAAM,SAAS,EAAE;AACvB,UAAM,MAAM,SAAS,KAAK,CAAC;AAC3B,UAAM,MAAM,SAAS,KAAK,CAAC;AAE3B,UAAM,MAAM,SAAS,EAAE;AACvB,UAAM,MAAM,SAAS,KAAK,CAAC;AAC3B,UAAM,MAAM,SAAS,KAAK,CAAC;AAE3B,UAAM,MAAM,SAAS,EAAE;AACvB,UAAM,MAAM,SAAS,KAAK,CAAC;AAC3B,UAAM,MAAM,SAAS,KAAK,CAAC;AAG3B,UAAM,MAAM,MAAM;AAClB,UAAM,MAAM,MAAM;AAClB,UAAM,MAAM,MAAM;AAElB,UAAM,MAAM,MAAM;AAClB,UAAM,MAAM,MAAM;AAClB,UAAM,MAAM,MAAM;AAGlB,UAAM,KAAK,MAAM,MAAM,MAAM;AAC7B,UAAM,KAAK,MAAM,MAAM,MAAM;AAC7B,UAAM,KAAK,MAAM,MAAM,MAAM;AAG7B,YAAQ,EAAE,KAAS;AACnB,YAAQ,KAAK,CAAC,KAAK;AACnB,YAAQ,KAAK,CAAC,KAAK;AAEnB,YAAQ,EAAE,KAAS;AACnB,YAAQ,KAAK,CAAC,KAAK;AACnB,YAAQ,KAAK,CAAC,KAAK;AAEnB,YAAQ,EAAE,KAAS;AACnB,YAAQ,KAAK,CAAC,KAAK;AACnB,YAAQ,KAAK,CAAC,KAAK;AAAA,EACvB;AAEA,WAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK,GAAG;AACxC,UAAM,IAAI,QAAQ,CAAC;AACnB,UAAM,IAAI,QAAQ,IAAI,CAAC;AACvB,UAAM,IAAI,QAAQ,IAAI,CAAC;AAEvB,UAAM,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC;AAC9B,QAAI,MAAM,MAAM;AACZ,cAAQ,CAAC,IAAQ,IAAI;AACrB,cAAQ,IAAI,CAAC,IAAI,IAAI;AACrB,cAAQ,IAAI,CAAC,IAAI,IAAI;AAAA,IACzB;AAAA,EACJ;AAGA,KAAG;AAAA,IACC,4BAA4B,YAAY;AAAA,IACxC,KAAK,UAAU;AAAA;AAAA,MAEX,UAAU,MAAM,KAAK,QAAQ;AAAA,MAC7B,SAAU,MAAM,KAAK,OAAO;AAAA,MAC5B;AAAA,IACJ,CAAC;AAAA,IACD;AAAA,EAEJ;AACJ;AAEA,IAAM,WAAW;AAEjB,IAAM,aAAuB,CAAC;AAE9B,IAAM,MAAM,MAAM,QAAQ,QAAQ;AAClC,iBAAiB,KAAK,KAAK;AACvB,MAAI,EAAE,OAAO,GAAG;AACZ,eAAW,KAAK,EAAE,IAAI;AAAA,EAC1B;AACJ;AAEA,WAAW,aAAa,YAAY;AAChC,MAAI,UAAU,SAAS,MAAM,GAAG;AAC5B,YAAQ,IAAI,cAAc,SAAS,KAAK;AACxC,UAAM,QAAQ,GAAG,QAAQ,IAAI,SAAS,EAAE;AAAA,EAC5C;AACJ;",
  "names": []
}
